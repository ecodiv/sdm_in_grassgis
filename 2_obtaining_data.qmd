---
lightbox:
  match: auto
  effect: none
  loop: true
---

# Acquire the data {#sec-data}

For this tutorial, we will download and import various data layers that we need to develop a potential distribution model/map for our species, the almond-eyed ringlet (*Erebia alberganus*). This includes species distribution data and environmental data layers. For visualization purposes, we'll use some background layers, including a map of the national borders of European countries, rivers, major roads and urban areas in Europe. 

## The database {#sec-creatingadatabase}

Once you have started GRASS, the first thing you normally do is to open the GRASS database, or to create a new one to do for this tutorial is to create a new GRASS database called [GRASSdb]{.style-db}. Next, create a new project called [SDM]{.style-db} with the coordinate reference system (CRS) [WGS84 lat/lon]{.style-parameter} ([EPSG 4326](https://epsg.io/4326)). The easiest way to do this is using the GUI, but if you want to make it part of an automated process, you can do this in Python as well.

::: {#exm-2vSeGTk3HW .hiddendiv}
:::

::: panel-tabset
## {{< fa regular window-restore >}}

{{< video "https://ecodiv.earth/share/sdm_in_grassgis/create_project.mp4" >}}

## {{< fa brands python >}}

``` python
# Create the folder for the GRASS database
os.mkdir("path_to_directory")

# Create a new Project
gs.create_project(
    path="path_to_directory/GRASSdb",
    name="SDM",
    epsg="4326",
)

# Change to the newly created Project / mapset
gs.run_command("g.mapset", mapset="PERMANENT", project="SDM")
```

## {{< fa question >}}

Replace the `path_to_directory` with the path to the directory where you want to create the database. Note, on Windows, paths are written using backslashes (\\) as the separator between folder names. On Unix based operating system such as macOS, Linux, and BSDs, the forward slash (/) is used as the path separator.
:::

Now that you have your database ready, you can start with the next step, which is getting and preparing the input data for the species distribution modeling.

## Working directory {#sec-workingdirectory}

Certain modules require a file as input or output. You can use the full path to the file. However, if you define a working directory and you put your files in that working directory, you only need to provide the path relative to the working directory[^2_obtaining_data-1]. For this section, create your own working directory where you will store the downloaded data. 

::: {.callout-warning appearance="simple"}
Never use the GRASS database directory, that you created in the previous section, for this. The GRASS directory is for GRASS data only
:::

[^2_obtaining_data-1]: The working directory is a directory where GRASS will look for or output files to if the full path is not specified.

::: {#exm-qpbGaVxfYh .hiddendiv}
:::

::: {.panel-tabset}
## {{< fa solid terminal >}}

Type [cd]{.style-function} followed by the path to the working directory in the [wxGUI Command Console]{.style-menu}. If you prefer to work on the terminal, run the same on the terminal.

``` bash
cd replace-for-path-to-working-directory
```

## {{< fa brands python >}}

``` python
import os
os.chdir("replace-for-path-to-working-directory")
```

## {{< fa regular window-restore >}}

The working directory can also be changed in wxGUI menu [Settings → GRASS working environment → Change working directory]{.style-function}

![Set the working directory via the menu or using the command line. After doing so, GRASS will look for files in that location if the full path is not provided.](images/setworkingdirectory.png){#fig-setworkingdirectory}
:::

Now, whenever you have to refer to an external file, such as text files or GeoTiff files, it is enough to specify the name of the file instead of the full path. 

## Base layers {#sec-baselayers}

We'll import a few base layers, including maps of the national boundaries, roads, rivers, and land use. They will serve as reference layers[^2_obtaining_data-2]. 

![This is the study area, which includes the national boundaries, main roads, and shaded relief (source: [Natural Earth](https://www.naturalearthdata.com/)) and the urban areas (source: [GLC](https://land.copernicus.eu/en/products/corine-land-cover)). See [@sec-appbaselayers] for information on how these layers were created.](images/reference_layers.png){#fig-baselayers}

[^2_obtaining_data-2]: *Reference layers* are datasets that provide context and help you to visually navigate the map and understand the geographic setting of the area being analyzed. One of the key advantages of modeling in a GIS environment is the ability to seamlessly integrate and compare model outcomes with these reference layers, and thus to explore and interpret results in their geographic context.

First, [download the Geopackage sdm_base_layers.gpkg](https://ecodiv.earth/share/sdm_in_grassgis/sdm_base_layers.gpkg) and copy the file to your working directory. A GeoPackage (GPKG) is an open, standards-based geospatial data format that can contain one data layer or multiple layers. This GPKG contains three vector layers with respectively the boundries of European countries ([countries]{.style-db}), the main rivers ([rivers]{.style-db}]) and the roads ([roads]{.style-db}])in Europe. Import these layers in GRASS.

::: {#exm-XmMn498Mh .hiddendiv}
:::

::: {.panel-tabset}
## {{< fa solid terminal >}}

``` bash
v.in.ogr input=sdm_base_layers.gpkg layer=countries output=countries
v.in.ogr input=sdm_base_layers.gpkg layer=roads output=roads
v.in.ogr input=sdm_base_layers.gpkg layer=rivers output=rivers
```

## {{< fa brands python >}}

``` python
gs.run_command(
    "v.in.ogr", input="sdm_base_layers.gpkg", layer="countries", output="countries"
)
gs.run_command(
    "v.in.ogr", input="sdm_base_layers.gpkg", layer="roads", output="roads"
)
gs.run_command(
    "v.in.ogr", input="sdm_base_layers.gpkg", layer="rivers", output="rivers"
)

```

## {{< fa regular window-restore >}}

Open the [v.in.ogr]]{.style-function} from the [File]{.style-menu} menu or from the [Toolbox]{.style-menu} and on the first tab [Required]{.style-function} find the GeoPackage you just downloaded. Or, if you copied the file to your working directory, you can simply fill in the name of the file under the [Source input]{.style-function}

![Name of the GeoPackage](images/baselayers_countries_step1.png){#fig-bcs1 fig-align="left" width=500}

Next, under the [Input]{.style-function} tab, select the layer [countries]{.style-parameter}. Leave the others unselected.

![Layer to import](images/baselayers_countries_step2.png){#fig-bcs1 fig-align="left" width=500}

And as last step, under the [Output]{.style-function} tab, give the output layer the name [countries]{.style-parameter}

![Layer to import](images/baselayers_countries_step3.png){#fig-bcs1 fig-align="left" width=500}

Now, repeat these steps for the other two layers. Make sure to give the [roads]{.style-data} layer the name [roads]{.style-parameter} and the [rivers]{.style-data} layer the name [rivers]{.style-parameter}.


## {{< fa question >}}

Note, the assumption is that the GeoPackage file is in your working directory, which you defined in @exm-qpbGaVxfYh. If not, you will have to provide the full path to the file.

When using `v.in.ogr`, a GeoPackage is treated as a container of separate layers, not a single dataset. That means that if the GeoPackage contains multiple layers, each layer must be explicitly specified and imported individually.

:::

Next, download the raster layers [shaded_relief_NE.tif](https://ecodiv.earth/share/sdm_in_grassgis/shaded_relief_NE.tif) and [urban_areas.tif](https://ecodiv.earth/share/sdm_in_grassgis/urban_areas.tif) and copy the file to your working directory. Next, import these layers in GRASS with the [r.in.gdal]{.style-function} function.


::: {#exm-Xm99Mh .hiddendiv}
:::

::: {.panel-tabset}
## {{< fa solid terminal >}}

``` bash
# Import urban areas raster
r.in.gdal input=urban_areas.tif output=urban_areas

# Import shaded relief raster
r.in.gdal input=shaded_relief_NE.tif output=shaded_relief_NE
```

## {{< fa brands python >}}

``` python
# Import urban areas raster
gs.run_command(
    "r.in.gdal",
    input="urban_areas.tif",
    output="urban_areas"
)

# Import shaded relief raster
gs.run_command(
    "r.in.gdal",
    input="shaded_relief_NE.tif",
    output="shaded_relief_NE"
)
```

## {{< fa regular window-restore >}}

Open the [r.in.gdal]{.style-function} from the [File]{.style-menu} menu or from the [Toolbox]{.style-menu} and on the first tab [Required]{.style-function} 

- Select as input the GeoTiff file [urban_areas.tif]{.style-db}
- Set the name of the output raster layer as [urban_areas]{.style-parameter}.
- Click on [Run]]{.style-function}

Now, repeat this, but:

- Select as input the GeoTiff file [shaded_relief_NE.tif]{.style-db}
- Set the name of the output raster layer as [shaded_relief_NE]{.style-parameter}.
- Click on [Run]]{.style-function}

:::

Open the layers in the Layers panel and style them as you like. You can also add any other layer. For example, you can add the Corina land use layer. I'll leave that as an exercise for you.

## Species data {#sec-speciesdata}

### Range map {#sec-rangemap}

Let's see what the experts have to say about the distribution of our species. A good starting point is the range maps from the [IUCN Red List](https://www.iucnredlist.org/) website. You'll need to log in first (create an account if you don't already have one), then use the search bar to find the species (search by scientific name). Note, however, that on the RedList, the use a different scientific name, namely *Erebia albergana* (that is something to take into account, in some cases, there is no consensus on the scientific name of a species). Download the range data and unzip it into your working directory[^2_obtaining_data-6].

[^2_obtaining_data-6]: Note that you are required to cite the data when using it in any publication. You can find the citation information on the webpage.

We'll create a new mapset [species_data]{.style-db} for our species distribution data and import the range map into this mapset.

::: {#exm-XmMn4IG2Mh .hiddendiv}
:::

::: {.panel-tabset}
## {{< fa solid terminal >}}

``` bash
g.mapset -c mapset=species_data
v.in.ogr input=data_0.shp output=Erebia_alberganus_rangemap
```

## {{< fa brands python >}}

``` python
gs.run_command("g.mapset", flags="c", mapset="species_data")
gs.run_command(
    "v.in.ogr",
    input="data_0.shp",
    output="Erebia_alberganus_rangemap",
)
```

## {{< fa regular window-restore >}}

Type in [g.mapset]{.style-function} in the console to open the dialog, and use the following parameter settings.

| Parameter                             | Value        |
|---------------------------------------|--------------|
| mapset                                | species_data |
| Create mapset if it doesn't exist (c) | ✅           |

: {tbl-colwidths="\[50,50\]"}

Run [v.in.ogr]{.style-function} with the following parameter settings:

| Parameter | Value                      |
|-----------|----------------------------|
| input     | data_0.shp                 |
| output    | Erebia_alberganus_rangemap |

: {tbl-colwidths="\[50,50\]"}
:::

### Occurrence data {#sec-occurrence}

The range map on the Red List website shows the boundaries of the area(s) where the species is thought to occur. The Global Biodiversity Information Facility ([GBIF](https://www.gbif.org/)) website provides information on where the species has actually been observed. The GBIF data is the type of data typically used for species distribution modeling. GBIF is an international open data infrastructure that provides free and open access to a vast amount of biodiversity data collected over three centuries of natural history exploration, including current observations from citizen scientists, researchers, and automated monitoring programs.

Before downloading data, you must first register on the site. Once logged in, search for *Erebia alberganus* von Prunner, 1798. Select the result and open the page. Then click on the green button with the number of observations to open the table with observations.

![At the time of writing, GBIF had 16468 occurrences of *Erebia alberganus*.](images/numberofoccurrences.png){#fig-numerofoccurrences fig-align="left"}

In the new window, apply any filters that you think are important. Note which filters and what settings you used to select the records. Tip: open the map tab and check the map each time you change a filter to see how it affects the selection of observations.

![The table shows all occurrence records for our species. In the panel at the left, you can select specific records based on a number of criteria.](images/gbifoccurrencefilters.png){#fig-gbiffilters fig-align="left"}

Click on the [download]{.style-menu} tab and select the [Simple]{.style-menu} option. This will take you to the download page (it may take a while to complete, but you get an email when the download is ready). When the download is complete, download the file and unzip into to your data .

::: callout-tip
It is good practice to cite the data you use in your publications. GBIF conveniently provides you with the citation on the download page, including a Digital Object Identifier (DOI). This is a link to a web page that describes your search, including any filters you have set. Copy and save the citation, so you can use it in your report. If you are using a reference manager such as [Zotero](https://www.zotero.org/) (highly recommended), you can use the provided BibTex or RIS file to import the reference.
:::

The downloaded file is a tab delimited text file, which can be imported with the [v.in.ascii](https://grass.osgeo.org/grass-stable/manuals/v.in.ascii.html) module. A more convenient way is to import the downloaded data using the [v.in.gbif](https://grass.osgeo.org/grass-stable/manuals/addons/v.in.gbif.html) module. It's an addon, so install it if you haven't done so yet.

::: {#exm-EZ65hmOvkK .hiddendiv}
:::

::: {.panel-tabset}
## {{< fa solid terminal >}}

``` bash
g.extension extension=v.in.gbif
v.in.gbif input=0104058-240626123714530.csv output=Erebia_alberganus_obs
```

## {{< fa brands python >}}

``` python
gs.run_command("g.extension", extension="v.in.gbif")
gs.run_command(
    "v.in.gbif", input="0104058-240626123714530.csv", output="Erebia_alberganus_obs"
)
```

## {{< fa regular window-restore >}}

Open the [g.extension]{.style-function} dialog, and run it with the following parameter settings:

| Parameter | Value     |
|-----------|-----------|
| Extension | v.in.gbif |

: {tbl-colwidths="\[50,50\]"}

Now, open the [v.in.gbif]{.style-function} dialog, and run it with the following parameter settings:

| Parameter | Value                       |
|-----------|-----------------------------|
| input     | 0104058-240626123714530.csv |
| output    | Erebia_alberganus_obs       |

: {tbl-colwidths="\[50,50\]"}
:::

The GBIF website provides a number of filters to remove problematic records, such as fossil records or observations without location data. Even so, it is good practice to also check the downloaded data carefully for outliers and other possible problems. For example, we can compare the occurrence data with the RED list range map (@fig-rangemapoccurrences), or compare the country or lower-level administrative subdivisions of the site, as specified in the attribute table, with the location on the map. Besides the obvious errors, you may also encounter observations that are in unexpected, but not impossible locations. In these cases, you will need to look for other information to help you decide whether to include these points in your analysis.

![The Red List range map (green outline) and the GBIF occurrence data of *Erebia alberganus*. See [here](#sec-rangemapoccurrences) for the code used to create this map.](images/rangemap.png){#fig-rangemapoccurrences fig-align="left"}

Although there are some noticeable discrepancies between the range map and the occurrence data, for the sake of this tutorial, we'll assume that the GBIF data is OK.

## Current climate {#sec-climatedata}

As explanatory variables for the species distribution modeling, we'll use the 19 [bioclimatic variables](https://www.worldclim.org/data/bioclim.html) from Worldclim[@fick2017]. Bioclimatic (or bioclim in short) variables are derived from the monthly temperature and rainfall values in order to generate more biologically meaningful variables[^2_obtaining_data-7]. They are available in raster format at different resolutions for historical[^2_obtaining_data-8] and future conditions. [Download](https://www.worldclim.org/data/worldclim21.html#) the 30 arc seconds[^2_obtaining_data-9] historical bioclim data (@fig-worldclimhistoricbioclim) and unzip the GeoTiff files to your working directory.

[^2_obtaining_data-7]: The bioclimatic variables represent annual trends (e.g., mean annual temperature, annual precipitation) seasonality (e.g., annual range in temperature and precipitation) and extreme or limiting environmental factors (e.g., temperature of the coldest and warmest month, and precipitation of the wet and dry quarters).

[^2_obtaining_data-8]: The historical climate data represents climate conditions for the period 1970-2000. For the modeling exercise, they are considered to represent the recent / current climate conditions.

[^2_obtaining_data-9]: You can download the data at another resolution as well. If you do, make sure to to adapt the relevant code examples accordingly.

![The Worldclim download page for the version 2.1 historical climate data, with the download link for the 30 arc-second bioclim variables.](images/worldclim_historic_bioclim.png){#fig-worldclimhistoricbioclim fig-align="left"}

We'll create a new mapset [climate]{.style-db} to store the climate data, using the [g.mapset](https://grass.osgeo.org/grass-stable/manuals/g.mapset.html) module with the [-c]{.style-parameter} flag. Next, we use the [ ](https://grass.osgeo.org/grass-stable/manuals/.html) module to set the boundaries of the region for which we want to import the data. One option is to use the region extent we defined earlier. Or, now that we know more precisely where our species has been observed, we can defined new bounds using the module with the [n]{.style-parameter}, [s]{.style-parameter}, [e]{.style-parameter}, and [w]{.style-parameter} parameters. We'll do the latter, and set the extent of the computational region to *54N*, *36S*, *-10w* and *32E*.

Note that, if the region and the raster layer are not perfectly aligned, the area that is imported will be slightly larger than the computational region. How much larger depends on the resolution of the computational region, as explained in (@sec-computationalregion). We therefore use the [res]{.style-parameter} parameter to set the resolution to match the resolution of the layers we want to import.

::: {#exm-OgizA6dRXy .hiddendiv}
:::

::: {.panel-tabset}
## {{< fa solid terminal >}}

``` bash
g.mapset -c mapset=climate_current
g.region n=54 s=36 w=-10 e=32 res=0.00833
```

## {{< fa brands python >}}

``` python
gs.run_command("g.mapset", flags="c", mapset="climate_current")
gs.run_command("g.region", n=54, s=36, w=-10, e=32, res=0.0083)
```

## {{< fa regular window-restore >}}

Type in [g.mapset]{.style-function} in the console to open the dialog, and use the following parameter settings.

| Parameter                             | Value           |
|---------------------------------------|-----------------|
| Name of mapset (mapset)               | climate_current |
| Create mapset if it doesn't exist (c) | ✅              |

: {tbl-colwidths="\[50,50\]"}

Next, run the [g.region]{.style-function} module with the following settings below. Alternatively, you can define the region's bounds manually in the [Map display]{.style-menu}, as explained in @sec-computationalregion.

| Parameter                       | Value   |
|---------------------------------|---------|
| Value for the northern edge (n) | 54      |
| Value for the southern edge (s) | 36      |
| Value for the eastern edge (e)  | 32      |
| Value for the western edge (w)  | -10     |
| 2D grid resolution (res)        | 0.00833 |

: {tbl-colwidths="\[50,50\]"}
:::

To import the bioclim data, we use [r.in.gdal](https://grass.osgeo.org/grass-stable/manuals/r.in.gdal.html) with the [-r]{.style-parameter} flag to tell GRASS to limit the import of the data to the area defined by the computational region that we defined in the previous step. To speed up the import, we use the [memory]{.style-parameter} parameter to set the maximum memory to be used (in MB) to be equal to the size of the input file (or otherwise to the maximum amount available on your system).

To avoid having to type in the same command 19 times, we can use a small script to automate the process. If you prefer to use the GUI, the [r.import](https://grass.osgeo.org/grass-stable/manuals/r.import.html) functions offers the possibility to batch import layers, as illustrated in the video under the [{{< fa regular window-restore >}}]{.paneltabcolor} tab.

::: {#exm-vavvH110fv .hiddendiv}
:::

::: {.panel-tabset}
## {{< fa solid terminal >}}

``` bash
base="wc2.1_30s_bio_"
for n in {1..19}; do
    input="${base}${n}.tif"
    output="bio_${n}"
    r.in.gdal -r input=${input} output=${output} memory=1000
done
```

## {{< fa brands python >}}

``` python
base = "wc2.1_30s_bio_"
for n in range(1, 20):
    input = f"{base}{n}.tif"
    output = f"bio_{n}"
    gs.run_command(
        "r.in.gdal",
        flags="r",
        input=input,
        output=output,
        memory=1000,
    )
```

## {{< fa regular window-restore >}}

{{< video "https://ecodiv.earth/share/sdm_in_grassgis/import_climate_data.mp4" >}}


## {{< fa question >}}

The code does the follow.

In the first line, you define the base name `wc2.1_30s_bio_`. Note that if you downloaded the lower resolution data, you need to change this to match the base name of the GeoTIFF files that you downloaded. In the for loop, the base name, number and file extension will be combined to the name of the file to be imported.

The 'for' loop will import the layer 1 to 19. Each round, 

1. the names of the input and output layers are created and used as input for r.in.gdal.
2. The number and file extension are added to complete the path+name of the file to be imported.
3.  The name of the imported raster layer is created by combining the base name (bio\_) and the number.

In the `r.in.gdal` command:

- the [-r]{.style-parameter} flag is set to limit the import to the regional bounds. 
- To speed up the import, the [memory]{.style-parameter} parameter should be set to be equal to the size of the import file. If that is not possible, use the maximum value that is possible on your system.

:::

As mentioned earlier, GRASS will import raster layers with the resolution and alignment of the original raster files. This means the computational region and the raster layers may not be perfectly aligned. In addition, the region’s resolution may not match that of the imported layers. To check this, you can run with the [-g]{.style-parameter} and compare the outcomes with those of the [r.info](https://grass.osgeo.org/grass-stable/manuals/r.info.html) module.

::: {#exm-uqHZOxgy43 .hiddendiv}
:::

::: {.panel-tabset}
## {{< fa solid terminal >}}

``` bash
g.region -p
r.info map=bio_1
```

## {{< fa brands python >}}

``` python
gs.run_command("g.region", flags="p")
gs.run_command("r.info", map="bio_1")
```

## {{< fa regular window-restore >}}

Type in in the console to open the [g.region]{.style-function} dialog, and use the following parameter settings.

| Parameter                    | Value |
|------------------------------|-------|
| Print the current region (p) | ✅    |

: {tbl-colwidths="\[50,50\]"}

Open the [r.info]{.style-function} dialog, and run it with the following parameter settings:

| Parameter | Value |
|-----------|-------|
| map       | bio_1 |

: {tbl-colwidths="\[50,50\]"}
:::

To ensure that the region's settings (extent, resolution, orientation) match those of the imported bioclim layers, we use the [g.region](https://grass.osgeo.org/grass-stable/manuals/.html) module again, but this time with the [raster]{.style-parameter} parameter[^2_obtaining_data-10]. Next, we run it again with the [save]{.style-parameter} parameter to save the region settings in the named region file [aoi]{.style-data}.

[^2_obtaining_data-10]: The different options of the [g.region]{.style-function} function provide a lot of flexibility in to how to define the region. You are encouraged to carefully consider the different options each time you use this module.

::: {#exm-V0FK3TyzcN .hiddendiv}
:::

::: {.panel-tabset}
## {{< fa solid terminal >}}

``` bash
g.region raster=bio_1
g.region save=aoi
```

## {{< fa brands python >}}

``` python
gs.run_command("g.region", raster="bio_1")
gs.run_command("g.region", save="aoi")
```

## {{< fa regular window-restore >}}

Open the dialog of the [g.region]{.style-function} module, and run it with the following parameter settings:

| Parameter | Value |
|-----------|-------|
| raster    | bio_1 |

: {tbl-colwidths="\[50,50\]"}

Run the module again, but now with the following parameter settings:

| Parameter                                                | Value |
|----------------------------------------------------------|-------|
| Save current region settings in named region file (save) | aoi   |

: {tbl-colwidths="\[50,50\]"}
:::

It is important to note that the geographic region is defined per mapset. It is therefore the computational region of the mapset you are working in that defines the geographic area and resolution in which raster analyses are performed[^2_obtaining_data-11]. See the [manual page](https://grass.osgeo.org/grass-stable/manuals/g.region.html) for more information.

[^2_obtaining_data-11]: Remember, the current region defines the geographic area in which all GRASS displays and raster analyses will be performed. Raster data will be resampled on-the-fly, if necessary, to match the resolution of the current geographic region setting. By default, GRASS uses the nearest neighbor method to resample the raster layer. This might not always be the best method. If not, you need to resample the data yourself, using the most appropriate method. See [menu: Raster → Develop raster map]{.style-menu} for options.

In Section [-@sec-nationalboundaries] we created the vector layer [aoi]{.style-data}. To avoid confusion, we will replace it with an updated version that represents the boundaries of the region we just defined. To do this, we must first switch to the [PERMANENT]{.style-db} mapset, change the computational region using the settings we just saved, and then use [v.in.region]() to create a vector polygon from the region's extent. Since there is already a vector layer named [aoi]{.style-data}, we use the [--overwrite]{.style-parameter} parameter to overwrite it.

::: {#exm-sm1p6oj49Z .hiddendiv}
:::

::: {.panel-tabset}
## {{< fa solid terminal >}}

``` bash
g.mapset mapset=PERMANENT
g.region region=aoi@climate_current
v.in.region output=aoi --overwrite
```

## {{< fa brands python >}}

``` python
gs.run_command("g.mapset", mapset="PERMANENT")
gs.run_command("g.region", region="aoi@climate_current")
gs.run_command("v.in.region", output="aoi", overwrite=True)
```

## {{< fa regular window-restore >}}

Run the [g.mapset]{.style-function} module with the following parameter settings:

| Parameter | Value     |
|-----------|-----------|
| mapset    | PERMANENT |

: {tbl-colwidths="\[50,50\]"}

Open the [g.region]{.style-function} dialog, and run it with the following settings:

| Parameter | Value                |
|-----------|----------------------|
| region    | aoi\@climate_current |

: {tbl-colwidths="\[50,50\]"}

Run the [v.in.region]{.style-function} module with the following parameter settings:

| Parameter                                                  | Value |
|------------------------------------------------------------|-------|
| output                                                     | aoi   |
| Allow output files to overwrite existing files (overwrite) | ✅    |

: {tbl-colwidths="\[50,50\]"}

## {{< fa question >}}

On the command line, `--overwrite` is used to tell GRASS to overwrite an existing layer. In Python, do do the same, you set the overwrite parameter to True or False, like: `overwrite=True`

:::

@fig-bioclimvars shows the bioclimatic maps 1 to 19 that we have just imported for our study area. The maps also show the range map of the Almond-eyed Ringlet butterfly. In case you are interested, see [here](#sec-bioclimvars) for the code used to create the maps.

::: {#fig-bioclimvars layout-ncol="4"}
![](images/bio_1.png){group="LRNlhoGosy"}

![](images/bio_2.png){group="LRNlhoGosy"}

![](images/bio_3.png){group="LRNlhoGosy"}

![](images/bio_4.png){group="LRNlhoGosy"}

![](images/bio_5.png){group="LRNlhoGosy"}

![](images/bio_6.png){group="LRNlhoGosy"}

![](images/bio_7.png){group="LRNlhoGosy"}

![](images/bio_8.png){group="LRNlhoGosy"}

![](images/bio_9.png){group="LRNlhoGosy"}

![](images/bio_10.png){group="LRNlhoGosy"}

![](images/bio_11.png){group="LRNlhoGosy"}

![](images/bio_12.png){group="LRNlhoGosy"}

![](images/bio_13.png){group="LRNlhoGosy"}

![](images/bio_14.png){group="LRNlhoGosy"}

![](images/bio_15.png){group="LRNlhoGosy"}

![](images/bio_16.png){group="LRNlhoGosy"}

![](images/bio_17.png){group="LRNlhoGosy"}

![](images/bio_18.png){group="group"}

![](images/bio_19.png){group="group"}

Bioclimatic variable 1 to 19 from [Worldclim version 2.0](https://www.worldclim.org/data/bioclim.html). The red outlines show the distribution of the Almond-eyed Ringlet butterfly according to the [IUCN Red List](https://www.iucnredlist.org/species/173278/6984115). Click on the image to enlarge and view the maps in detail.
:::

## Future climates {#sec-obtainfutureclimatelayers}

To model the potential distribution of our species under future climate conditions, we use downscaled [future climate projections](https://www.worldclim.org/data/cmip6/cmip6climate.html) from Worldclim. There are bioclim data from 14 different general circulation models (GCMs) available for download. For each GCM, you can choose between data representing projected conditions in the periods (2021–2040, 241–2060, 2061–2080, and 2081-2100). You can furthermore choose between data based on the Shared Socio-economic Pathways ([SSPs](https://www.carbonbrief.org/cmip6-the-next-generation-of-climate-models-explained)) 126, 245, 370 and 585. We'll use the 30 arc-seconds bioclim variables for the period 2081-2100 based on the SSP585 from the GCM [EC-Earth3-Veg]{.style-data}. Download the data and save it to your working directory.

We'll create a new mapset [climate_EC_Earth3_Veg]{.style-db} to store the climate data using the [g.mapset](https://grass.osgeo.org/grass-stable/manuals/g.mapset.html) module. We use the [region]{.style-parameter} parameter to define the computational region. As input, we use the region file [aoi\@climate_current]{.style-db} that we created in @exm-V0FK3TyzcN [^2_obtaining_data-12].

[^2_obtaining_data-12]: The [aoi]{.style-data} region file is not stored in the current mapset but in the [climate_current]{.style-db} mapset. We can refer to objects (raster and vector maps and region files) stored in another mapset by appending a [\@]{.style-parameter} to the name of the object, followed by the name of the mapset. Strictly speaking, this is not always needed (see the [manual page](https://grass.osgeo.org/grass83/manuals/grass_database.html) for details), but it is good practice as it avoids possible confusion if there are layers with the same name in multiple mapsets.

::: {#exm-5XQmiajE7Z .hiddendiv}
:::

::: {.panel-tabset}
## {{< fa solid terminal >}}

``` bash
g.mapset -c mapset=climate_EC_Earth3_Veg
g.region region=aoi@climate_current 
```

## {{< fa brands python >}}

``` python
gs.run_command("g.mapset", flags="c", mapset="climate_EC_Earth3_Veg")
gs.run_command("g.region", region="aoi@climate_current")
```

## {{< fa regular window-restore >}}

Type in [g.mapset]{.style-function} in the console to open the dialog, and use the following parameter settings.

| Parameter                             | Value                 |
|---------------------------------------|-----------------------|
| Name of mapset (mapset)               | climate_EC_Earth3_Veg |
| Create mapset if it doesn't exist (c) | ✅                    |

: {tbl-colwidths="\[50,50\]"}

Next, run the [g.region]{.style-function} module with the following settings:

| Parameter | Value                |
|-----------|----------------------|
| region    | aoi\@climate_current |

: {tbl-colwidths="\[50,50\]"}
:::

Unlike the data for current climate conditions, the data consists of one geoTIF file. The file has 19 bands, representing the 19 bioclimatic variables. To verify this, you can use the [gdalinfo](https://gdal.org/en/latest/programs/gdalinfo.html) function from the command line.

::: panel-tabset
## {{< fa solid terminal >}}

``` bash
gdalinfo wc2.1_30s_bioc_EC-Earth3-Veg_ssp585_2081-2100.tif 
```

![[gdalinfo]{.style-function} prints the names and some basic information about each of the bands in the GeoTiff file. The names of the first two bands are marked with a red outline.](images/gdalinfo_futclim.png){#fig-gdalinfofutclim}
:::

The [r.in.gdal](https://grass.osgeo.org/grass-stable/manuals/r.in.gdal.html) module conveniently imports each band as a separate layer. The value of the [output]{.style-parameter} parameter will be used as prefix for the name of the imported raster layers, followed by the band number. If possible, use the [memory]{.style-parameter} parameter to increase the memory to be used by the module as this can speed up the import considerably.

::: {#exm-1a5tTJ1LeP .hiddendiv}
:::

::: {.panel-tabset}
## {{< fa solid terminal >}}

``` bash
r.in.gdal -r input=wc2.1_30s_bioc_EC-Earth3-Veg_ssp585_2081-2100.tif output=bio memory=1000
```

## {{< fa brands python >}}

``` python
gs.run_command(
    "r.in.gdal",
    flags="r",
    input="wc2.1_30s_bioc_EC-Earth3-Veg_ssp585_2081-2100.tif",
    output="bio",
    memory=1000,
)
```

## {{< fa regular window-restore >}}

Type in [r.in.gdal]{.style-function} in the console to open the dialog, and use the following parameter settings.

| Parameter | Value |
|----|----|
| input | wc2.1_30s_bioc_EC-Earth3-Veg_ssp585_2081-2100.tif |
| output | bio |
| memory | 1000 |
| Limit import to current region (r) | ✅ |
:::

@fig-futbioclimvars shows the projected bioclimatic conditions for 2081-2100 (bioclim variables 1 to 19) that we have just imported for our study area. The maps also show the range map of the Almond-eyed Ringlet butterfly.

::: {#fig-futbioclimvars layout-ncol="4"}
![](images/futbio_1.png){group="NsFOs6E8BO"}

![](images/futbio_2.png){group="NsFOs6E8BO"}

![](images/futbio_3.png){group="NsFOs6E8BO"}

![](images/futbio_4.png){group="NsFOs6E8BO"}

![](images/futbio_5.png){group="NsFOs6E8BO"}

![](images/futbio_6.png){group="NsFOs6E8BO"}

![](images/futbio_7.png){group="NsFOs6E8BO"}

![](images/futbio_8.png){group="NsFOs6E8BO"}

![](images/futbio_9.png){group="\"NsFOs6E8BO"}

![](images/futbio_10.png){group="NsFOs6E8BO"}

![](images/futbio_11.png){group="NsFOs6E8BO"}

![](images/futbio_12.png){group="NsFOs6E8BO"}

![](images/futbio_13.png){group="NsFOs6E8BO"}

![](images/futbio_14.png){group="NsFOs6E8BO"}

![](images/futbio_15.png){group="NsFOs6E8BO"}

![](images/futbio_16.png){group="NsFOs6E8BO"}

![](images/futbio_17.png){group="NsFOs6E8BO"}

![](images/futbio_18.png){group="NsFOs6E8BO"}

![](images/futbio_19.png){group="NsFOs6E8BO"}

Projected bioclimatic conditions for the period 2081-2100 based on the SSP585 from the GCM EC-Earth3-Veg. Source: [Worldclim version 2.0](https://www.worldclim.org/data/bioclim.html). The red outlines show the distribution of the Almond-eyed Ringlet butterfly according to the [IUCN Red List](https://www.iucnredlist.org/species/173278/6984115). Click on the image to enlarge and view the maps in detail.
:::

<br><br>

## Footnotes {.unlisted .unnumbered .hidefootnotes}
